{"meta":{"title":"Jason Say","subtitle":null,"description":null,"author":"Jason Wang","url":"http://yoursite.com"},"pages":[],"posts":[{"title":"java实现kubernates API的访问调用","slug":"java实现kubernates-API的访问调用","date":"2017-08-07T01:44:33.000Z","updated":"2017-08-07T01:46:02.787Z","comments":true,"path":"2017/08/07/java实现kubernates-API的访问调用/","link":"","permalink":"http://yoursite.com/2017/08/07/java实现kubernates-API的访问调用/","excerpt":"","text":"1. 前言kubernetes及各开源社区为开发人员提供了各种语言版的Client Library，让我们可以通过编程的方式可以实现调用Kubernetes API，从而完成pod、service、RC等资源的图形化创建和管理。本篇主要介绍使用java语言的实现 2. 使用场景开发基于kubernetes的容器云管理平台 3. 基于的框架用java语言开发的有两种，一个是基于Jersey的，一个是基于Fabric8。 -Jersey是一个方便简化开发RESRFul Web Service的框架，契合kubernetesAPI的设计，所以采用jersey会比较省力，但还是需要开发者自己做很多工作。 -Fabric8中的kubernates-client.xx.jar，kubernates-model.xx.jar等工具包包对kubernates api做了很好的封装，访问代码比较简单。 本篇将选择fabric8实现 4. 使用步骤4.1 首先导入核心jar包 4.2 创建连接API-Server的client123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102package org.demo.framework.engine.k8s.util;import io.fabric8.kubernetes.api.model.*;import io.fabric8.kubernetes.api.model.extensions.*;import io.fabric8.kubernetes.api.model.extensions.Deployment;import io.fabric8.kubernetes.client.Config;import io.fabric8.kubernetes.client.ConfigBuilder;import io.fabric8.kubernetes.client.*;import okhttp3.TlsVersion;import org.apache.log4j.Logger;import java.io.Closeable;import java.util.ArrayList;import java.util.LinkedList;import java.util.List;import java.util.Map;public class Fabric8KubeUtils implements KubeUtils&lt;KubernetesClient&gt; &#123; private KubernetesClient client; private static final int CONNECTION_TIMEOUT = 3 * 1000; private static final int REQUEST_TIMEOUT = 3 * 1000; private static Logger logger = Logger.getLogger(Fabric8KubeUtils.class); @Override public KubernetesClient getClient() &#123; return client; &#125; @Override public void setClient(KubernetesClient client) &#123; this.client = client; &#125; private Fabric8KubeUtils(KubernetesClient client) &#123; this.client = client; &#125; /**传入参数，连接k8s的api server**/ public static KubeUtils buildKubeUtils(Cluster cluster, String namespace) throws K8sDriverException &#123; if (cluster == null) &#123; throw new K8sDriverException(&quot;cluster is null&quot;); &#125; String key = cluster.md5Key(namespace); if (KUBEUTILSMAP.containsKey(key)) &#123; return KUBEUTILSMAP.get(key); &#125; String master = cluster.getApi(); master = CommonUtil.fullUrl(master); if (StringUtils.isBlank(master)) &#123; throw new K8sDriverException(&quot;master api is null, cluster id=&quot; + cluster.getId() + &quot;, cluster name=&quot; + cluster.getName()); &#125; Config config; if (master.toLowerCase().startsWith(&quot;https://&quot;)) &#123; config = new ConfigBuilder().withMasterUrl(master) .withTrustCerts(true) .withNamespace(namespace) .withOauthToken(cluster.getOauthToken()) .withUsername(cluster.getUsername()) .withPassword(cluster.getPassword()) .removeFromTlsVersions(TlsVersion.TLS_1_0) .removeFromTlsVersions(TlsVersion.TLS_1_1) .removeFromTlsVersions(TlsVersion.TLS_1_2) .withRequestTimeout(REQUEST_TIMEOUT) .withConnectionTimeout(CONNECTION_TIMEOUT) .build(); &#125; else &#123; config = new ConfigBuilder().withMasterUrl(master) .withNamespace(namespace) .withOauthToken(cluster.getOauthToken()) .withUsername(cluster.getUsername()) .withPassword(cluster.getPassword()) .removeFromTlsVersions(TlsVersion.TLS_1_0) .removeFromTlsVersions(TlsVersion.TLS_1_1) .removeFromTlsVersions(TlsVersion.TLS_1_2) .withTrustCerts(true) .withRequestTimeout(REQUEST_TIMEOUT) .withConnectionTimeout(CONNECTION_TIMEOUT) .build(); &#125; KubeUtils kubeUtils = buildKubeUtils(config); KUBEUTILSMAP.putIfAbsent(key, kubeUtils); return kubeUtils; &#125; /**创建client**/ public static KubeUtils buildKubeUtils(Config config) throws K8sDriverException &#123; KubernetesClient client; try &#123; client = new DefaultKubernetesClient(config); &#125; catch (Exception e) &#123; throw new K8sDriverException(&quot;instantialize kubernetes client error&quot;); &#125; return new Fabric8KubeUtils(client); &#125; &#125; 4.3 创建k8s的资源对象，作为参传给client操作k8s（增删改时需要）123// 可以通过k8s??Builder()来创建资源对象// 如下创建一个service对象，lb为包含service必要信息的实体类对象Service newService = new K8sServiceBuilder(lb).build(); 4.4 通过得到的client，可以对k8s的各种资源增删改查各种操作：NodesNamespacesServicesReplicationcontrollersPodsDeploymentsResourcequotas1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768/**创建pod**/@Override public Pod createPod(Pod pod) throws K8sDriverException &#123; logger.debug(&quot;create pod with specify=&quot; + pod.toString()); try &#123; return client.pods().create(pod); &#125; catch (KubernetesClientException e) &#123; throw new K8sDriverException(e.getMessage()); &#125; &#125;/**创建service**/@Overridepublic Service createService(Service service) throws K8sDriverException &#123; logger.debug(&quot;create service=&quot; + service); if (service == null) &#123; return null; &#125; try &#123; return client.services().create(service); &#125; catch (KubernetesClientException e) &#123; throw new K8sDriverException(e.getMessage()); &#125;&#125;/**创建RC**/ @Override public ReplicationController createReplicationController(ReplicationController rc) throws K8sDriverException &#123; if (rc == null) &#123; return null; &#125; logger.debug(&quot;create replication controller with rc=\\n&quot; + rc); try &#123; return client.replicationControllers().create(rc); &#125; catch (KubernetesClientException e) &#123; throw new K8sDriverException(e.getMessage()); &#125; &#125;/**创建deployment**/@Override public Deployment createDeployment(Deployment deployment) throws K8sDriverException &#123; if (deployment == null) &#123; return null; &#125; logger.debug(&quot;create deployment with deployment=\\n&quot; + deployment); try &#123; return client.extensions().deployments().create(deployment); &#125; catch (KubernetesClientException e) &#123; throw new K8sDriverException(e.getMessage()); &#125; &#125;/**按条件列出所有node**/@Override public NodeList listNode(Map&lt;String, String&gt; labelSelector) throws K8sDriverException &#123; logger.debug(&quot;list node with selector=&quot; + labelSelector); try &#123; return client.nodes().withLabels(labelSelector).list(); &#125; catch (KubernetesClientException e) &#123; throw new K8sDriverException(e.getMessage()); &#125; &#125;","categories":[{"name":"docker","slug":"docker","permalink":"http://yoursite.com/categories/docker/"}],"tags":[{"name":"kuberbets","slug":"kuberbets","permalink":"http://yoursite.com/tags/kuberbets/"}]},{"title":"用python 分析微信好友信息并生成词云","slug":"用python 分析微信好友信息并生成词云","date":"2017-08-07T01:24:33.000Z","updated":"2017-08-07T01:50:17.806Z","comments":true,"path":"2017/08/07/用python 分析微信好友信息并生成词云/","link":"","permalink":"http://yoursite.com/2017/08/07/用python 分析微信好友信息并生成词云/","excerpt":"","text":"在知乎上偶然看到有人推荐itchart这个微信接口，抱着好奇的想法尝试了以下，果然非常好玩。官方链接：http://itchat.readthedocs.io/zh/latest/#itchat 目录结构get_info.py这个类用来爬取好友信息并保存到指定文件12345678910111213141516171819202122232425import itchatimport osimport timebasepath = os.path.dirname(os.path.realpath(__file__))download_path = basepath+&apos;\\downloads&apos;+ &apos;\\\\&apos;# 调用itchat接口登录并拉取数据itchat.login()friends = itchat.get_friends(update=True)[0:]fmt=&apos;%Y%m%d%H%M%S&apos; #定义时间显示格式Date=time.strftime(fmt,time.localtime(time.time()))download_file_name = &apos;friendslist_&apos;+friends[0][&apos;NickName&apos;]+ &apos;_&apos; + Date + &apos;.txt&apos;f = open(download_path+download_file_name,&apos;wb&apos;)print(download_path+download_file_name)for i in friends[1:]: friend = (str(i) + &quot;\\n&quot;).encode(encoding=&apos;gb18030&apos;) # print(str(i)) f.write(friend)f.close() analyse.py这个类根据下载的好友数据分析好友信息1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768# Author:Jason.wangimport reimport osimport timebase_pic = &quot;C:/Users/Think/Pictures/Saved Pictures/beb28c538ac52a91.jpg&quot;source_file = &quot;friendslist_雨佳Clara_20170724223344.txt&quot;source_file = &quot;friendslist_say_20170724132202.txt&quot;basepath = os.path.dirname(os.path.realpath(__file__))download_file = basepath+&apos;\\downloads\\\\&apos;+ source_filefs_str = &apos;&apos;with open(download_file,&apos;rb&apos;) as f: fs_str = f.read().decode(&apos;gb18030&apos;)friends = fs_str.split(&apos;\\n&apos;)# 初始化计数器 male = female = other = 0# 所有省份Provinces_list = []#friends[0]是自己的信息，所以要从friends[1]开始 for i in friends: if i.__len__()&gt;0: i = i.replace(&apos;&lt;ContactList: [&apos;,&apos;&quot;&lt;ContactList: [&apos;) i = i.replace(&apos;]&gt;&apos;,&apos;]&gt;&quot;&apos;) friend = eval(i) # 统计性别 sex = friend[&quot;Sex&quot;] if sex == 1: male += 1 exit elif sex ==2: female += 1 else: other+=1 # 统计地区 Province = friend[&quot;Province&quot;] Provinces_list.append(Province)#计算朋友总数 total = len(friends)#打印出自己的好友性别比例 print(&quot;总好友数： %d&quot; % total + &quot;\\n&quot; + &quot;男性好友： %d 个,占比 %.2f%%&quot; % (male,(float(male)/total*100)) + &quot;\\n&quot; + &quot;女性好友： %d 个,占比 %.2f%%&quot; % (female,(float(female) / total * 100)) + &quot;\\n&quot; + &quot;不明性别好友： %d 个,占比 %.2f%%&quot; % (other,(float(other) / total * 100)))Provinces_set = set(Provinces_list)Provinces_dict = &#123;&#125;for i in Provinces_set: Provinces_dict[i] = Provinces_list.count(i)# 对省份字典按value排序Provinces_dict = sorted(Provinces_dict.items(),key=lambda asd:asd[1],reverse=True)print(&quot;===============人数排名前10地区如下==================&quot;)top = 0for k,v in Provinces_dict: if top&lt;10: print(&quot;%s : %d 个，占比 ： %.2f%%&quot; % (k,v,float(v)/total*100)) top+=1 输出结果： ciyun.py根据签名生成词云123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# -*- coding:UTF-8 -*-# Author:Jason.wangimport reimport osimport timebase_pic = &quot;C:/Users/Think/Pictures/Saved Pictures/beb28c538ac52a91.jpg&quot;source_file = &quot;friendslist_雨佳Clara_20170724223344.txt&quot;# source_file = &quot;friendslist_say_20170724132202.txt&quot;basepath = os.path.dirname(os.path.realpath(__file__))download_file = basepath+&apos;\\downloads\\\\&apos;+ source_filefs_str = &apos;&apos;with open(download_file,&apos;rb&apos;) as f: fs_str = f.read().decode(&apos;gb18030&apos;)friends = fs_str.split(&apos;\\n&apos;)siglist = []for i in friends: if i.__len__()&gt;0: i = i.replace(&apos;&lt;ContactList: [&apos;,&apos;&quot;&lt;ContactList: [&apos;) i = i.replace(&apos;]&gt;&apos;,&apos;]&gt;&quot;&apos;) friend = eval(i) # print(friend) # print(friend[&quot;Signature&quot;]) signature = friend[&quot;Signature&quot;].strip().replace(&quot;span&quot;,&quot;&quot;).replace(&quot;class&quot;,&quot;&quot;).replace(&quot;emoji&quot;,&quot;&quot;) rep = re.compile(&quot;1f\\d+\\w*|[&lt;&gt;/=]&quot;) signature = rep.sub(&quot;&quot;,signature) siglist.append(signature)text = &quot;&quot;.join(siglist)import jiebawordlist = jieba.cut(text,cut_all=True)word_space_split = &quot; &quot;.join(wordlist).replace(&quot;\\n&quot;,&quot;&quot;)print(word_space_split)import matplotlib.pyplot as pltfrom wordcloud import WordCloud, ImageColorGeneratorimport numpy as npimport PIL.Image as Imagecoloring = np.array(Image.open(base_pic))my_wordcloud = WordCloud(background_color=&quot;white&quot;,max_words=2000, mask=coloring,max_font_size=60,random_state=42,scale=2, font_path=&quot;C:/windows/fonts/SimHei.ttf&quot;).generate(word_space_split)image_colors = ImageColorGenerator(coloring)plt.imshow(my_wordcloud.recolor(color_func=image_colors))plt.imshow(my_wordcloud)plt.axis(&quot;off&quot;)plt.show() 效果：","categories":[{"name":"python","slug":"python","permalink":"http://yoursite.com/categories/python/"}],"tags":[{"name":"python","slug":"python","permalink":"http://yoursite.com/tags/python/"},{"name":"微信","slug":"微信","permalink":"http://yoursite.com/tags/微信/"},{"name":"爬虫","slug":"爬虫","permalink":"http://yoursite.com/tags/爬虫/"}]}]}